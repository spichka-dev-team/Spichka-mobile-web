(()=>{var e={};e.id=569,e.ids=[569],e.modules={1154:(e,t,r)=>{"use strict";r.d(t,{p:()=>i});var s=r(60687),a=r(43210),n=r(96241);let i=a.forwardRef(({className:e,type:t,...r},a)=>(0,s.jsx)("input",{type:t,className:(0,n.cn)("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:a,...r}));i.displayName="Input"},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11723:e=>{"use strict";e.exports=require("querystring")},12412:e=>{"use strict";e.exports=require("assert")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},21820:e=>{"use strict";e.exports=require("os")},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},29578:(e,t,r)=>{"use strict";r.d(t,{UpdateProfilePage:()=>j});var s=r(60687),a=r(43210),n=r(28559);let i=(0,r(62688).A)("camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);var o=r(16189),l=r(51060),c=r(30474),d=r(41862),u=r(71232),p=r(1154),h=r(96241),m=r(38691),x=r.n(m);let f=e=>e.replace(/\D+/g,""),g=e=>{let t=f(e);return t?("8"===t[0]&&(t="7"+t.slice(1)),"7"!==t[0]&&(t="9"===t[0]?"7"+t:"7"+t.slice(0,10)),t.slice(0,11)):""},b=e=>{let t=g(e).slice(1),r=t.slice(0,3),s=t.slice(3,6),a=t.slice(6,8),n=t.slice(8,10),i="+7";return r&&(i+=` (${r}`),r&&3===r.length&&(i+=")"),s&&(i+=` ${s}`),a&&(i+=`-${a}`),n&&(i+=`-${n}`),i},v=e=>11===g(e).length,k=[{image:"/images/onboarding/hand.png",title:"делись своими проектами",description:"покажи миру, над чем работаешь — от идей до больших запусков",cta:"ка-а-айф",imageAlt:"Рука с жестом V"},{image:"/images/onboarding/handPen.png",title:"публикуй статьи и делись контентом",description:"фото, видео, статьи, подборки — оформляй как хочешь. Делись мыслями, опытом и вдохновляй.",cta:"имба",imageAlt:"Рука с карандашом"},{image:"/images/onboarding/carousel.png",title:"события и балдёж",description:"находи площадки, запускай движ, расскажи где проходят события и собирай гостей в своих пространствах.",cta:"то что нужно!",imageAlt:"Карусель"},{image:"/images/onboarding/phone.png",title:"мы свяжемся",description:"введите номер телефона чтобы связались с вами позже",cta:"стать креатором",imageAlt:"Телефон",kind:"phone"}];function w(e){let t=(0,a.useMemo)(()=>(e.slides?.length?e.slides:k).map(e=>({kind:"content",...e})),[e.slides]),[r,i]=(0,a.useState)(0),o=t[r],[l,m]=(0,a.useState)("+7 ("),[f,w]=(0,a.useState)(!1),y="phone"===o.kind&&v(l)&&!f,j=(0,a.useCallback)(async()=>{if("phone"===o.kind){if(!y)return;w(!0),e.setFormData(e=>({...e,phone_number:g(l)})),e.onFinish?.(),e.setOnboarding(!1),w(!1);return}i(r=>r<t.length-1?r+1:(e.onFinish?.(),r))},[o.kind,y,e,t.length,l]),N=(0,a.useCallback)(()=>{i(e=>Math.max(0,e-1))},[]),P=(0,a.useRef)(null),T=e=>{m(b(e))};return(0,s.jsx)("section",{ref:e.ref,"aria-roledescription":"carousel","aria-label":"Онбординг",className:(0,h.cn)("relative w-screen min-h-screen overflow-y-auto bg-neutral-900 text-white",e.className,x().BackgroundGradient),children:(0,s.jsx)("div",{className:"relative mx-auto h-full w-full px-4 max-w-sm",onTouchStart:e=>{P.current=e.touches[0].clientX},onTouchEnd:e=>{if(null===P.current)return;let t=e.changedTouches[0].clientX-P.current;t<-40&&j(),t>40&&N(),P.current=null},children:(0,s.jsxs)("div",{className:"relative h-full pt-[10vh] pb-7 flex flex-col justify-between",children:[(0,s.jsx)("div",{className:"relative w-full h-72 sm:h-80 flex items-center justify-center",children:(0,s.jsx)(c.default,{src:o.image,alt:o.imageAlt||"Иллюстрация слайда",fill:!0,sizes:"(max-width: 640px) 100vw, 480px",style:{objectFit:"contain"},priority:0===r})}),(0,s.jsxs)("div",{className:"relative mt-10 h-52 z-10 space-y-6 px-6 pb-6 text-center",children:[(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)("h3",{className:"text-2xl font-extrabold leading-tight sm:text-3xl",children:o.title}),(0,s.jsx)("p",{className:"text-sm leading-relaxed text-white/80",children:o.description})]}),"phone"===o.kind&&(0,s.jsxs)("div",{className:"mx-auto w-full",children:[(0,s.jsx)("label",{htmlFor:"phone",className:"sr-only",children:"Номер телефона"}),(0,s.jsx)(p.p,{id:"phone",type:"tel",inputMode:"tel",placeholder:"+7 (",value:l,onChange:e=>T(e.target.value),className:(0,h.cn)("h-11 rounded-full bg-white/10 text-white placeholder:text-white/60 border-0","focus-visible:ring-2 focus-visible:ring-white/30 focus-visible:ring-offset-0"),maxLength:18,"aria-invalid":!v(l)})]})]}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)("div",{className:"flex items-center justify-center gap-[5px]",children:t.map((e,t)=>(0,s.jsx)("span",{"aria-hidden":"true",className:(0,h.cn)("h-[6px] rounded-full bg-white/40 transition-all duration-300 ease-in-out",t===r?"w-[20px] bg-white cursor-auto":"w-[6px] cursor-pointer")},t))}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[r>0&&(0,s.jsx)(u.$,{variant:"secondary",onClick:N,className:"h-11 w-11 shrink-0 rounded-full bg-white text-black hover:bg-white/80",children:(0,s.jsx)(n.A,{className:"h-5 w-5"})}),(0,s.jsx)(u.$,{onClick:j,disabled:"phone"===o.kind&&!y,className:(0,h.cn)("h-11 w-full flex-1 rounded-full text-black","phone"===o.kind?"bg-white disabled:bg-white/30":"bg-white hover:bg-white/90"),children:"phone"===o.kind&&f?(0,s.jsxs)("span",{className:"inline-flex items-center gap-2",children:[(0,s.jsx)(d.A,{className:"h-4 w-4 animate-spin"}),"отправляем..."]}):o.cta})]})]})]})})})}let y="https://d2.vencera.tech",j=({data:e,token:t})=>{let r=(0,o.useRouter)(),[d,u]=(0,a.useState)({avatar:e.avatar||"",first_name:e.first_name||"",last_name:e.last_name||"",username:e.username||"",phone_number:e.phone_number||""}),[p,h]=(0,a.useState)(!1),[m,x]=(0,a.useState)(e.avatar||null),[f,g]=(0,a.useState)(!1),b=(0,a.useRef)(null),v=(e,t)=>{u(r=>({...r,[e]:t}))},k=async()=>{h(!0);try{let e=await l.A.patch(`${y}/users/me`,d,{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});console.log("Profile updated successfully:",e.data),r.push("/profile")}catch(e){console.error("Ошибка при обновлении профиля:",e)}finally{h(!1)}},j=()=>{b.current?.click()},N=async()=>{g(!0),console.log("Become creator clicked")},P=async e=>{let r=e.target.files?.[0];if(!r)return;let s=new FormData;s.append("file",r),s.append("type",r.type),s.append("storage","s3"),s.append("filename_download",r.name);try{let e=await fetch(`${y}/files`,{method:"POST",headers:{Authorization:`Bearer ${t}`},body:s});if(!e.ok)throw Error("Ошибка при загрузке файла");let r=await e.json();console.log("Файл загружен:",r),x(r?.data.id),u(e=>({...e,avatar:r?.data.id}))}catch(e){console.error("Ошибка загрузки аватарки:",e)}};return(0,s.jsx)(s.Fragment,{children:f?(0,s.jsx)(w,{setFormData:u,setOnboarding:g}):(0,s.jsxs)("div",{className:"min-h-screen pb-20 bg-black text-white",children:[(0,s.jsxs)("div",{className:"flex items-center px-4 py-4",children:[(0,s.jsx)("button",{onClick:()=>r.back(),className:"mr-4",children:(0,s.jsx)(n.A,{className:"w-6 h-6"})}),(0,s.jsx)("h1",{className:"text-lg font-medium",children:"редактирование"})]}),(0,s.jsxs)("div",{className:"px-6 pt-8",children:[(0,s.jsxs)("div",{className:"flex flex-col items-center mb-12",children:[(0,s.jsxs)("div",{className:"relative mb-4",children:[(0,s.jsx)("div",{className:"w-24 h-24 rounded-full overflow-hidden bg-gray-800",children:m?(0,s.jsx)(c.default,{src:`/api/proxy/image?id=${m}`||"/placeholder.svg",alt:"Profile",width:96,height:96,className:"w-full h-full object-cover"}):(0,s.jsx)("div",{className:"w-full h-full bg-gradient-to-br from-purple-500 to-blue-600 flex items-center justify-center",children:(0,s.jsx)("span",{className:"text-2xl font-bold",children:d.first_name.charAt(0).toUpperCase()})})}),(0,s.jsx)("input",{type:"file",accept:"image/*",ref:b,className:"hidden",onChange:P}),(0,s.jsx)("button",{onClick:j,className:"absolute -bottom-1 -right-1 w-8 h-8 bg-gray-700 rounded-full flex items-center justify-center",children:(0,s.jsx)(i,{className:"w-4 h-4"})})]}),(0,s.jsx)("button",{onClick:j,className:"text-gray-400 text-sm",children:"изменить фото профиля"})]}),(0,s.jsxs)("div",{className:"space-y-6 mb-8",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-white text-sm font-medium mb-2",children:"имя"}),(0,s.jsx)("input",{type:"text",value:d.first_name,onChange:e=>v("first_name",e.target.value),className:"w-full bg-gray-800 text-white px-4 py-3 rounded-lg border-none outline-none focus:ring-2 focus:ring-gray-600",placeholder:"Введите имя"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-white text-sm font-medium mb-2",children:"имя"}),(0,s.jsx)("input",{type:"text",value:d.last_name,onChange:e=>v("last_name",e.target.value),className:"w-full bg-gray-800 text-white px-4 py-3 rounded-lg border-none outline-none focus:ring-2 focus:ring-gray-600",placeholder:"Введите имя"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-white text-sm font-medium mb-2",children:"имя пользователя"}),(0,s.jsx)("input",{type:"text",value:d.username,onChange:e=>v("username",e.target.value),className:"w-full bg-gray-800 text-white px-4 py-3 rounded-lg border-none outline-none focus:ring-2 focus:ring-gray-600",placeholder:"@username"})]})]}),!e.isCreator&&(0,s.jsx)("button",{onClick:N,className:"w-full py-3 mb-8 border border-white rounded-lg text-white font-medium hover:bg-white hover:text-black transition-colors",children:"стать креатором"})]}),(0,s.jsx)("div",{className:"bottom-8 left-6 right-6",children:(0,s.jsx)("button",{onClick:k,disabled:p,className:"w-full py-4 bg-white text-black rounded-lg font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:p?"Сохранение...":"сохранить"})}),(0,s.jsx)("div",{className:"fixed bottom-2 left-1/2 transform -translate-x-1/2",children:(0,s.jsx)("div",{className:"w-32 h-1 bg-white rounded-full"})})]})})}},33873:e=>{"use strict";e.exports=require("path")},38691:e=>{e.exports={BackgroundGradient:"styles_BackgroundGradient__Y1LAE"}},40487:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>i.a,__next_app__:()=>u,pages:()=>d,routeModule:()=>p,tree:()=>c});var s=r(65239),a=r(48088),n=r(88170),i=r.n(n),o=r(30893),l={};for(let e in o)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>o[e]);r.d(t,l);let c={children:["",{children:["(platform)",{children:["profile",{children:["update",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,93645)),"/root/spichka/Spichka-mobile-web/app/(platform)/profile/update/page.tsx"]}]},{}]},{loading:[()=>Promise.resolve().then(r.bind(r,58349)),"/root/spichka/Spichka-mobile-web/app/(platform)/profile/loading.tsx"]}]},{layout:[()=>Promise.resolve().then(r.bind(r,82937)),"/root/spichka/Spichka-mobile-web/app/(platform)/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,57398,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(r.t.bind(r,89999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(r.t.bind(r,65284,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,46055))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(r.bind(r,58014)),"/root/spichka/Spichka-mobile-web/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,57398,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(r.t.bind(r,89999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(r.t.bind(r,65284,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,46055))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]}.children,d=["/root/spichka/Spichka-mobile-web/app/(platform)/profile/update/page.tsx"],u={require:r,loadChunk:()=>Promise.resolve()},p=new s.AppPageRouteModule({definition:{kind:a.RouteKind.APP_PAGE,page:"/(platform)/profile/update/page",pathname:"/profile/update",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},41098:(e,t,r)=>{"use strict";r.d(t,{N:()=>o});var s=r(13581),a=r(94612);let n=process.env.API_URL||"https://d2.vencera.tech";async function i(e){try{console.log("♻️ Запрос на обновление токена"),console.log("Текущий refreshToken:",e.refreshToken);let t=await a.A.post(`${n}/auth/refresh`,{refresh_token:e.refreshToken});return console.log("✅ Ответ от /auth/refresh:",t.data),{...e,accessToken:t.data.data.access_token,accessTokenExpiry:Date.now()+t.data.data.expires,refreshToken:t.data.data.refresh_token??e.refreshToken}}catch(t){return console.error("❌ Ошибка при обновлении токена",t),{...e,error:"RefreshAccessTokenError"}}}let o={providers:[(0,s.A)({name:"Credentials",credentials:{email:{label:"Email",type:"text"},password:{label:"Password",type:"password"}},async authorize(e){if(console.log(e),!e)return null;try{let t=await a.A.post(`${n}/auth/login`,{password:e.password,email:e.email});if(console.log(t.data.data),t.data.data.access_token)return{id:t.data.data.id??"",email:e.email,accessToken:t.data.data.access_token,expiresIn:t.data.data.expires,refreshToken:t.data.data.refresh_token};return null}catch(e){throw Error(e?.message||"Authorization error")}}})],callbacks:{jwt:async({token:e,user:t})=>(t&&(e.accessToken=t.accessToken,e.accessTokenExpiry=Date.now()+t.expiresIn,e.refreshToken=t.refreshToken,console.log("\uD83D\uDD11 Логин: accessToken:",e.accessToken),console.log("\uD83D\uDD04 Логин: refreshToken:",e.refreshToken)),Math.round(e.accessTokenExpiry-6e4-Date.now())>0)?(console.log("⏩ Токен ещё жив, рефреш не нужен"),Promise.resolve(e)):(console.log("⚠️ Токен просрочен или скоро истечёт, делаем рефреш..."),console.log("\uD83D\uDD04 После рефреша: refreshToken:",(e=await i(e)).refreshToken),console.log("\uD83D\uDD04 После рефреша: accessToken:",e.accessToken),e),session:async({session:e,token:t})=>(e.accessToken=t.accessToken,e.accessTokenExpiry=t.accessTokenExpiry,e.refreshToken=t.refreshToken,e.error=t.error,Promise.resolve(e))},secret:process.env.NEXTAUTH_SECRET}},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},57750:(e,t,r)=>{Promise.resolve().then(r.bind(r,29578))},58349:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});var s=r(37413),a=r(19555);function n(){return(0,s.jsx)(a.g,{})}},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},79428:e=>{"use strict";e.exports=require("buffer")},79444:(e,t,r)=>{"use strict";r.d(t,{UpdateProfilePage:()=>s});let s=(0,r(12907).registerClientReference)(function(){throw Error("Attempted to call UpdateProfilePage() from the server but UpdateProfilePage is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/root/spichka/Spichka-mobile-web/components/pages/UpdateProfilePage/ui/UpdateProfilePage.tsx","UpdateProfilePage")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},83997:e=>{"use strict";e.exports=require("tty")},93645:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>c});var s=r(37413),a=r(94612),n=r(79444),i=r(35426),o=r(41098);let l=process.env.API_URL,c=async()=>{let e=await (0,i.getServerSession)(o.N);if(!e?.accessToken)return console.error("No auth token found"),(0,s.jsx)("div",{children:"Ошибка: Токен не найден"});try{let t=(await a.A.get(`${l}/users/me`,{headers:{Authorization:`Bearer ${e?.accessToken}`}})).data.data;return console.log("User data for update:",t),(0,s.jsx)(n.UpdateProfilePage,{data:t,token:e?.accessToken})}catch(e){return console.error("Ошибка при получении данных пользователя:",e),(0,s.jsx)("div",{children:"Произошла ошибка"})}}},94702:(e,t,r)=>{Promise.resolve().then(r.bind(r,79444))},94735:e=>{"use strict";e.exports=require("events")}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[243,783,612,567,558,17,60,653,475,788,673,999,112,290,249,464,395],()=>r(40487));module.exports=s})();